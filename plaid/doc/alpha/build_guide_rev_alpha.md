ビルドガイド - PCB Rev.Alpha
===================================================================

## 注意
Rev.AlphaのPCBにはいくつか失敗があります。  
動作・組立自体には問題ありません。
- 最下段の真ん中を2Uスペースバーにするためのスタビライザーの穴がない
- R2,R3のシルクが間違っている。
- USBコネクタのシェル部分のパッドが少し小さい。
- シルクが綺麗でない
- 工場管理用のIDが裏面に小さくシルクとして書かれている

また、手元で組み立てたものでWindows10,OSX,Ubuntuの動作確認は行っていますが、USB機能が搭載されていないMCUを用いたUSBデバイス実装である[V-USB](https://www.obdev.at/products/vusb/index.html)を使っているため、部品のばらつきなどで安定した動作が出来ない場合があります。

プレートがないため、CherryMX互換PCBマウント(5ピン)スイッチ専用です。
プレート用(3ピン)スイッチでも作れますがスイッチをまっすぐ固定するのが大変難しいです。

## パーツリスト

組立を始める前にパーツリストと付属している部品の個数があっているか確認して下さい。   
不足があればhsgwまでご連絡下さい。すぐにお送りします。

|Ref|数量||
| :- |  :- |  :- | 
|C1,C2|2|積層セラミックコンデンサ 22pF or 20pF|
|C3|1|電解コンデンサ 10uF|
|C4,C5|2|積層セラミックコンデンサ 0.1uF|
|D1-48|48|汎用ダイオード|
|D49,D50|2|ツェナーダイオード 3.6V|
|F1|1|ポリスイッチ 100mA|
|J1|1|USB miniBコネクタ Omron XM7D-0512 |
|J2|1|2x3 ピンヘッダー|
|LED1|1|3mm LED 赤|
|LED2|1|3mm LED 緑|
|R1,R7,R8|3|抵抗 1.5kΩ|
|R2,R3|2|抵抗 75Ω|
|R4|1|抵抗 10kΩ|
|SW50,SW51|2|タクトスイッチ|
|U1|1|ATMEGA328P ブートローダ書込済|
|Y1|1|クリスタル 16MHz|
|PCB|1|MainとBottom|
|ねじ|10|M2 8mm|
|ナット|30|M2|
|ゴム足|4||

### 付属していないもの
- USB MiniBケーブル
- CherryMX互換スイッチ  (48個・PCBマウント/5ピン専用)

## 見分けがつきにくい部品
C1,C2の**22pFもしくは20pF**とC4,C5の**O.1uF**が同じ形状・色のものが入っている場合があります。   
(22pFもしくは20pFがどちらか2つ入っています。)   
どちらの場合も**22pFもしくは20pF**の方は別の袋にクリスタルと一緒に入っています。   
混ぜないように気をつけて下さい。   
もし混ざってしまった場合はテスターで計測するか、部品に印刷された型番をルーペなどで拡大して確認して下さい。 

部品上の値の読み方

|値|部品上|
| :- | :- |
|0.1uF|104|
|(どちらか一種)|
|22pF|220|
|20pF|200|

抵抗はカラーコードを読むかテスターで確認して下さい。   

|値|カラーコード|
| :- | :- |
|1.5kΩ|茶緑赤金|
|75Ω|紫緑黒金|
|10kΩ|茶黒橙金|

## 組立
回路図 https://github.com/hsgw/plaid/blob/master/pcb/plaid.pdf

基本的に背の低いものから順にはんだづけしてください。  

ダイオードとLED,電解コンデンサには向きがあります。   
ダイオードとLEDは四角いパッドの方がカソードです。   
電解コンデンサは基板に"+"マークのある方がアノード、反対がカソードです。   
ICにも向きがあります。シルクの切り欠けとIC、ICソケットの切掛けをあわせるようにしてください。

**R2とR3はシルクに間違いがあります。75Ωです。**

USBコネクタのピンは間隔が狭く、ブリッジしやすいです。   
ブリッジして修正しても壊れないように設計していますが、注意深くはんだづけしてショートしてないか必ず確認して下さい。   

スイッチをつける前に電源とUSBの信号線がショートしてないか確認して、USBブートローダと書込の動作確認することをオススメします。

ネジ類は上面から、`ネジ-MAIN PCB-ナット-ナット-Bottom PCB-ナット`の順で取り付けてください。

現状、ファームウェアで特に設定していないのでLEDは光りませんが、ハンダ面のLEDというジャンパーをはんだづけしないとLEDとの配線が繋がりません。

I2Cを使用する場合は、LEDと配線を共有しているのでI2Cのプルアップ抵抗を実装して、LEDのジャンパーを取り外して下さい。

## bootloaderについて
ピン設定をカスタマイズしたUSBaspLoaderを利用しています。
発送前に書込済です。

https://github.com/hsgw/USBaspLoader/tree/plaid

なんらかの理由でbootloaderが壊れてしまった場合は基板上のISP端子から書き込んでください。


## ファームウェアについて
本家のQMK Firmwareには取り込まれていないため、以下のブランチをcloneするかダウンロードしてください。

https://github.com/hsgw/qmk_firmware/tree/plaid

```make plaid:default```
でコンパイルできます。

書き込む場合はブートローダモードに入る必要があります。   
基板上のRESETボタンを押しながら、BOOTボタンを押してその後RESET→BOOTの順に離してください。 
(BOOTボタンを先に押してしまうと変な入力がされてしまうので注意！)  
デバイスマネージャ上で`usbasp`が認識されるはずなので```make plaid:default:program```を実行します。   
書込後、一度リセットするとキーボードとして認識されます。

### windowsの場合
デバイスドライバを入れる必要があります。   
[zadig](http://zadig.akeo.ie/)を使って`libusbK`を導入してください。

参考:https://ht-deko.com/arduino/usbasp.html


